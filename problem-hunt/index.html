<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Problem Hunt - Find Validated Problems to Build</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: #F9FAFB;
            color: #111827;
            line-height: 1.6;
        }

        /* Landing Page */
        .landing {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            overflow: hidden;
        }

        .landing::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: float 20s linear infinite;
        }

        @keyframes float {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        .hero {
            max-width: 900px;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .hero h1 {
            font-size: clamp(3rem, 8vw, 5rem);
            font-weight: 700;
            color: white;
            margin-bottom: 1rem;
            text-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .tagline {
            font-size: clamp(1.2rem, 3vw, 1.8rem);
            color: rgba(255,255,255,0.95);
            margin-bottom: 1rem;
            font-style: italic;
        }

        .subheadline {
            font-size: clamp(1rem, 2.5vw, 1.4rem);
            color: rgba(255,255,255,0.9);
            margin-bottom: 3rem;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .cta-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 4rem;
        }

        .btn {
            padding: 1rem 2.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            min-width: 200px;
            min-height: 56px;
        }

        .btn-primary {
            background: white;
            color: #6366F1;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .btn-secondary {
            background: transparent;
            color: white;
            border: 2px solid white;
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }

        .value-props {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .value-prop {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .value-prop h3 {
            color: white;
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
        }

        .value-prop p {
            color: rgba(255,255,255,0.9);
            font-size: 1rem;
        }

        /* App Interface */
        .app {
            display: none;
            min-height: 100vh;
        }

        .app.active {
            display: block;
        }

        .app-header {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: #6366F1;
            cursor: pointer;
        }

        .search-bar {
            flex: 1;
            max-width: 500px;
            min-width: 200px;
        }

        .auth-buttons {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .auth-buttons span {
            color: #374151;
            font-weight: 500;
        }

        .search-bar input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
        }

        .search-bar input:focus {
            outline: none;
            border-color: #6366F1;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            gap: 2rem;
            padding: 2rem;
        }

        /* Sidebar */
        .sidebar {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            height: fit-content;
            position: sticky;
            top: 100px;
        }

        .sidebar h3 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: #111827;
        }

        .filter-group {
            margin-bottom: 1.5rem;
        }

        .filter-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
            font-size: 0.9rem;
        }

        .filter-group select {
            width: 100%;
            padding: 0.5rem;
            border: 2px solid #E5E7EB;
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.9rem;
        }

        /* Main Feed */
        .main-feed {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .feed-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .feed-header h2 {
            font-size: 1.8rem;
            color: #111827;
        }

        .sort-dropdown select {
            padding: 0.75rem 1rem;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.95rem;
            cursor: pointer;
        }

        /* Problem Cards */
        .problem-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .problem-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .upvote-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            padding: 0.5rem;
            background: #F3F4F6;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 60px;
        }

        .upvote-btn:hover {
            background: #E5E7EB;
        }

        .upvote-btn.upvoted {
            background: #D1FAE5;
            border-color: #10B981;
        }

        .upvote-icon {
            font-size: 1.2rem;
        }

        .upvote-count {
            font-weight: 600;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #111827;
        }

        .card-content {
            flex: 1;
        }

        .problem-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #111827;
            margin-bottom: 0.5rem;
            line-height: 1.3;
        }

        .problem-description {
            color: #6B7280;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .card-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
        }

        .category-tag {
            background: #EEF2FF;
            color: #6366F1;
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .budget {
            font-weight: 700;
            color: #10B981;
            font-size: 1.1rem;
            font-family: 'Courier New', monospace;
        }

        .stat {
            color: #6B7280;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid #E5E7EB;
        }

        .author {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #6B7280;
            font-size: 0.9rem;
        }

        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .submit-proposal {
            background: #6366F1;
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-family: inherit;
            transition: all 0.2s ease;
            min-height: 44px;
        }

        .submit-proposal:hover {
            background: #4F46E5;
            transform: translateY(-1px);
        }

        .proposal-badge {
            background: #FEF3C7;
            color: #92400E;
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .proposals-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #E5E7EB;
        }

        .proposal-card {
            background: #F9FAFB;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.75rem;
        }

        .proposal-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.5rem;
        }

        .tip-btn {
            background: #10B981;
            color: white;
            border: none;
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .tip-btn:hover {
            background: #059669;
        }

        .proposal-title {
            font-weight: 600;
            color: #111827;
            font-size: 1rem;
        }

        .proposal-description {
            color: #6B7280;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .proposal-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
            color: #6B7280;
        }

        .proposal-link {
            color: #6366F1;
            text-decoration: none;
        }

        .proposal-link:hover {
            text-decoration: underline;
        }

        .view-proposals-btn {
            background: transparent;
            color: #6366F1;
            border: 1px solid #6366F1;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .view-proposals-btn:hover {
            background: #EEF2FF;
        }

        .empty-proposals {
            text-align: center;
            color: #6B7280;
            padding: 2rem;
            font-style: italic;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #6B7280;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: #374151;
        }

        .empty-state p {
            margin-bottom: 2rem;
        }

        /* Right Sidebar */
        .right-sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .widget {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .widget h3 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: #111827;
        }

        /* FAB */
        .fab {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: #6366F1;
            color: white;
            width: 64px;
            height: 64px;
            border-radius: 50%;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(99,102,241,0.4);
            transition: all 0.3s ease;
            z-index: 90;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(99,102,241,0.5);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-header h2 {
            font-size: 1.8rem;
            color: #111827;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #6B7280;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #374151;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #6366F1;
        }

        .submit-btn {
            width: 100%;
            background: #6366F1;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .submit-btn:hover {
            background: #4F46E5;
        }

        /* Mobile Menu */
        .mobile-menu-btn {
            display: none;
            background: #6366F1;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            min-height: 44px;
            min-width: 44px;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .app-container {
                grid-template-columns: 1fr 300px;
            }

            .sidebar {
                display: none;
            }

            .sidebar.mobile-active {
                display: block;
                position: fixed;
                top: 0;
                left: 0;
                width: 280px;
                height: 100vh;
                z-index: 200;
                overflow-y: auto;
                box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            }

            .mobile-menu-btn {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
                padding: 1rem;
                gap: 1rem;
            }

            .right-sidebar {
                display: none;
            }

            .header-content {
                padding: 0;
            }

            .search-bar {
                order: 3;
                width: 100%;
                max-width: 100%;
            }

            .app-header {
                padding: 1rem;
            }

            .fab {
                bottom: 1rem;
                right: 1rem;
                width: 56px;
                height: 56px;
                font-size: 1.5rem;
            }

            .card-header {
                flex-direction: column;
            }

            .upvote-btn {
                align-self: flex-start;
            }
        }
    </style>
</head>
<body>
    <!-- Landing Page -->
    <div class="landing" id="landing">
        <div class="hero">
            <h1>Problem Hunt</h1>
            <p class="tagline">Houston, we have a problem.</p>
            <p class="subheadline">The marketplace where people post problems they'd pay to solve - and builders compete to solve them.</p>
            
            <div class="cta-buttons">
                <button class="btn btn-primary" onclick="showApp()">Browse Problems</button>
                <button class="btn btn-secondary" onclick="showApp(); showModal()">Post a Problem</button>
            </div>

            <div class="value-props">
                <div class="value-prop">
                    <h3>üí° For people with problems</h3>
                    <p>Signal demand. Get solutions built.</p>
                </div>
                <div class="value-prop">
                    <h3>üõ†Ô∏è For builders</h3>
                    <p>Find validated problems. Build what people actually want.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- App Interface -->
    <div class="app" id="app">
        <header class="app-header">
            <div class="header-content">
                <div class="logo" onclick="showLanding()">Problem Hunt</div>
                <button class="mobile-menu-btn" onclick="toggleMobileMenu()">‚ò∞ Filters</button>
                <div class="search-bar">
                    <input type="text" placeholder="Search problems..." id="searchInput" onkeyup="filterProblems()">
                </div>
                <div id="authButtons" class="auth-buttons">
                    <button class="btn btn-secondary" onclick="showAuthModal('signin')">Sign In</button>
                    <button class="btn btn-primary" onclick="showAuthModal('signup')">Sign Up</button>
                </div>
            </div>
        </header>

        <div class="app-container">
            <!-- Left Sidebar -->
            <aside class="sidebar" id="sidebar">
                <h3>Filters</h3>
                
                <div class="filter-group">
                    <label>Category</label>
                    <select id="categoryFilter" onchange="filterProblems()">
                        <option value="all">All Categories</option>
                        <option value="Productivity">Productivity</option>
                        <option value="Social">Social</option>
                        <option value="Finance">Finance</option>
                        <option value="Health">Health</option>
                        <option value="Developer Tools">Developer Tools</option>
                        <option value="Entertainment">Entertainment</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label>Budget Range</label>
                    <select id="budgetFilter" onchange="filterProblems()">
                        <option value="all">All Budgets</option>
                        <option value="0-10">$0 - $10</option>
                        <option value="10-25">$10 - $25</option>
                        <option value="25-50">$25 - $50</option>
                        <option value="50+">$50+</option>
                    </select>
                </div>
            </aside>

            <!-- Main Feed -->
            <main class="main-feed">
                <div class="feed-header">
                    <h2>All Problems</h2>
                    <div class="sort-dropdown">
                        <select id="sortSelect" onchange="sortProblems()">
                            <option value="upvotes">Most Upvotes</option>
                            <option value="newest">Newest</option>
                            <option value="budget">Highest Budget</option>
                        </select>
                    </div>
                </div>

                <div id="problemFeed"></div>
            </main>

            <!-- Right Sidebar -->
            <aside class="right-sidebar">
                <div class="widget">
                    <h3>üöÄ Getting Started</h3>
                    <p style="color: #6B7280; margin-bottom: 1rem;">Welcome to Problem Hunt! Here's how it works:</p>
                    <ol style="color: #6B7280; padding-left: 1.25rem;">
                        <li style="margin-bottom: 0.5rem;">Browse problems people want solved</li>
                        <li style="margin-bottom: 0.5rem;">Submit proposals for problems you can solve</li>
                        <li style="margin-bottom: 0.5rem;">Get direct access to paying customers</li>
                    </ol>
                </div>

                <div class="widget">
                    <h3>üí° Post Your Problem</h3>
                    <p style="color: #6B7280; margin-bottom: 1rem;">Have a problem that needs solving? Post it and see if builders want to help!</p>
                    <button class="btn btn-primary" style="width: 100%; min-width: auto;" onclick="showModal()">Post Problem</button>
                </div>
            </aside>
        </div>

        <button class="fab" onclick="showModal()">+</button>
    </div>

    <!-- Problem Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Post a Problem</h2>
                <button class="close-modal" onclick="closeModal()">√ó</button>
            </div>
            
            <form id="problemForm">
                <div class="form-group">
                    <label>Problem Title</label>
                    <input type="text" id="problemTitle" placeholder="What problem do you need solved?" required>
                </div>

                <div class="form-group">
                    <label>Description</label>
                    <textarea id="problemDescription" placeholder="Describe your problem in detail..." required></textarea>
                </div>

                <div class="form-group">
                    <label>Category</label>
                    <select id="problemCategory" required>
                        <option value="">Select a category</option>
                        <option value="Productivity">Productivity</option>
                        <option value="Social">Social</option>
                        <option value="Finance">Finance</option>
                        <option value="Health">Health</option>
                        <option value="Developer Tools">Developer Tools</option>
                        <option value="Entertainment">Entertainment</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>I'd pay this much</label>
                    <input type="text" id="problemBudget" placeholder="e.g., $20/month or $5/use" required>
                </div>

                <div class="form-group">
                    <label>Your Name (optional)</label>
                    <input type="text" id="problemAuthor" placeholder="Your name">
                </div>

                <button type="submit" class="submit-btn">Submit Problem</button>
            </form>
        </div>
    </div>

    <!-- Proposal Modal -->
    <div class="modal" id="proposalModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Submit Proposal</h2>
                <button class="close-modal" onclick="closeProposalModal()">√ó</button>
            </div>
            
            <div style="background: #F3F4F6; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                <strong>Problem:</strong>
                <p id="proposalProblemTitle" style="margin-top: 0.5rem; color: #374151;"></p>
            </div>

            <form id="proposalForm">
                <input type="hidden" id="proposalProblemId">
                
                <div class="form-group">
                    <label>Solution Title</label>
                    <input type="text" id="proposalTitle" placeholder="What's your solution called?" required>
                </div>

                <div class="form-group">
                    <label>How will you solve it?</label>
                    <textarea id="proposalDescription" placeholder="Describe your proposed solution in detail..." required></textarea>
                </div>

                <div class="form-group">
                    <label>Timeline</label>
                    <input type="text" id="proposalTimeline" placeholder="e.g., 2 weeks, 1 month" required>
                </div>

                <div class="form-group">
                    <label>Your Name</label>
                    <input type="text" id="proposalBuilderName" placeholder="Your name or company" required>
                </div>

                <div class="form-group">
                    <label>GitHub URL (optional)</label>
                    <input type="url" id="proposalGithubUrl" placeholder="https://github.com/yourusername">
                </div>

                <div class="form-group">
                    <label>Demo URL (optional)</label>
                    <input type="url" id="proposalDemoUrl" placeholder="https://your-demo.com">
                </div>

                <button type="submit" class="submit-btn">Submit Proposal</button>
            </form>
        </div>
    </div>

    <!-- Auth Modal -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="authModalTitle">Sign In</h2>
                <button class="close-modal" onclick="closeAuthModal()">√ó</button>
            </div>
            
            <div id="authForms">
                <!-- Sign In Form -->
                <form id="signInForm" style="display: block;">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="signInEmail" placeholder="your@email.com" required>
                    </div>

                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="signInPassword" placeholder="Your password" required>
                    </div>

                    <button type="submit" class="submit-btn">Sign In</button>
                    <p style="text-align: center; margin-top: 1rem;">
                        Don't have an account? 
                        <a href="#" onclick="showSignUpForm()">Sign up</a>
                    </p>
                </form>

                <!-- Sign Up Form -->
                <form id="signUpForm" style="display: none;">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="signUpEmail" placeholder="your@email.com" required>
                    </div>

                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="signUpPassword" placeholder="Create a password" required>
                    </div>

                    <div class="form-group">
                        <label>Display Name</label>
                        <input type="text" id="signUpName" placeholder="Your name or username" required>
                    </div>

                    <button type="submit" class="submit-btn">Sign Up</button>
                    <p style="text-align: center; margin-top: 1rem;">
                        Already have an account? 
                        <a href="#" onclick="showSignInForm()">Sign in</a>
                    </p>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="lib/config.js"></script>
    <script>
        // API Configuration
        const API_BASE_URL = window.location.hostname === 'localhost' 
            ? '/api'
            : '/api';

        // Supabase Configuration - Loaded from config.js
        // DO NOT hardcode credentials here - use environment variables

        // Current user state
        let currentUser = null;

        // Auth functions
        async function initAuth() {
            const { data: { session } } = await supabase.auth.getSession();
            currentUser = session?.user || null;
            updateAuthUI();
        }

        function updateAuthUI() {
            const authButtons = document.getElementById('authButtons');
            if (currentUser) {
                authButtons.innerHTML = `
                    <span>Welcome, ${currentUser.user_metadata?.name || currentUser.email}!</span>
                    <button class="btn btn-secondary" onclick="signOut()">Sign Out</button>
                `;
            } else {
                authButtons.innerHTML = `
                    <button class="btn btn-secondary" onclick="showAuthModal('signin')">Sign In</button>
                    <button class="btn btn-primary" onclick="showAuthModal('signup')">Sign Up</button>
                `;
            }
        }

        function showAuthModal(type) {
            document.getElementById('authModal').classList.add('active');
            if (type === 'signup') {
                showSignUpForm();
            } else {
                showSignInForm();
            }
        }

        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('active');
            document.getElementById('signInForm').reset();
            document.getElementById('signUpForm').reset();
        }

        function showSignInForm() {
            document.getElementById('signInForm').style.display = 'block';
            document.getElementById('signUpForm').style.display = 'none';
            document.getElementById('authModalTitle').textContent = 'Sign In';
        }

        function showSignUpForm() {
            document.getElementById('signInForm').style.display = 'none';
            document.getElementById('signUpForm').style.display = 'block';
            document.getElementById('authModalTitle').textContent = 'Sign Up';
        }

        async function signOut() {
            await supabase.auth.signOut();
            currentUser = null;
            updateAuthUI();
        }

        // Initial data - just one example
        let problems = [
            {
                id: '1',
                title: 'A browser extension that blocks LinkedIn recruiters unless they mention salary',
                description: 'Tired of "exciting opportunity" messages that waste my time. Only show me messages that include actual compensation information upfront.',
                category: 'Productivity',
                budgetValue: 10,
                upvotes: 127,
                proposals: 3,
                author: 'Anonymous User',
                time: '2 hours ago',
                upvoted: false
            }
        ];

        let allProblems = [...problems];

        // Page navigation
        function showLanding() {
            document.getElementById('landing').style.display = 'flex';
            document.getElementById('app').classList.remove('active');
        }

        function showApp() {
            document.getElementById('landing').style.display = 'none';
            document.getElementById('app').classList.add('active');
            loadProblems();
        }

        function toggleMobileMenu() {
            document.getElementById('sidebar').classList.toggle('mobile-active');
        }

        // Modal functions
        function showModal() {
            if (!currentUser) {
                alert('Please sign in to post a problem.');
                showAuthModal('signin');
                return;
            }
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
            document.getElementById('problemForm').reset();
        }

        function showProposalModal(problemId, problemTitle) {
            if (!currentUser) {
                alert('Please sign in to submit a proposal.');
                showAuthModal('signin');
                return;
            }
            document.getElementById('proposalModal').classList.add('active');
            document.getElementById('proposalProblemId').value = problemId;
            document.getElementById('proposalProblemTitle').textContent = problemTitle;
        }

        function closeProposalModal() {
            document.getElementById('proposalModal').classList.remove('active');
            document.getElementById('proposalForm').reset();
        }

        // Load problems from API or use local data
        async function loadProblems() {
            try {
                const response = await fetch(`${API_BASE_URL}/problems`);
                if (response.ok) {
                    const data = await response.json();
                    allProblems = data.problems || data;
                    problems = [...allProblems];
                    renderProblems(problems);
                } else {
                    renderProblems(problems);
                }
            } catch (error) {
                console.log('Using local data');
                renderProblems(problems);
            }
        }

        // Render problems
        function renderProblems(problemsToRender) {
            const feed = document.getElementById('problemFeed');
            
            if (problemsToRender.length === 0) {
                feed.innerHTML = `
                    <div class="empty-state">
                        <h3>No problems found</h3>
                        <p>Be the first to post a problem that needs solving!</p>
                        <button class="btn btn-primary" onclick="showModal()">Post a Problem</button>
                    </div>
                `;
                return;
            }

            feed.innerHTML = problemsToRender.map(p => `
                <div class="problem-card">
                    <div class="card-header">
                        <button class="upvote-btn ${p.upvoted ? 'upvoted' : ''}" onclick="toggleUpvote('${p.id}')">
                            <span class="upvote-icon">‚ñ≤</span>
                            <span class="upvote-count">${p.upvotes}</span>
                        </button>
                        <div class="card-content">
                            <h3 class="problem-title">${p.title}</h3>
                            <p class="problem-description">${p.description}</p>
                            <div class="card-meta">
                                <span class="category-tag">${p.category}</span>
                                <span class="budget">${p.budget}</span>
                                <span class="stat">${p.proposals} proposal${p.proposals !== 1 ? 's' : ''}</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="author">
                            <div class="avatar">${p.author.substring(0, 2).toUpperCase()}</div>
                            <span>Posted by ${p.author} ‚Ä¢ ${p.time}</span>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            ${p.proposals > 0 ? `<button class="view-proposals-btn" onclick="viewProposals('${p.id}')">View ${p.proposals} Proposal${p.proposals > 1 ? 's' : ''}</button>` : ''}
                            <button class="submit-proposal" onclick="showProposalModal('${p.id}', '${p.title.replace(/'/g, "\\'")}')">Submit Proposal</button>
                        </div>
                    </div>
                    <div class="proposals-section" id="proposals-${p.id}" style="display: none;"></div>
                </div>
            `).join('');
        }

        // Toggle upvote
        async function toggleUpvote(problemId) {
            const problem = problems.find(p => p.id === problemId);
            if (!problem) return;

            try {
                if (problem.upvoted) {
                    const response = await fetch(`${API_BASE_URL}/problems/${problemId}/upvote`, {
                        method: 'DELETE'
                    });
                    if (response.ok) {
                        problem.upvoted = false;
                        problem.upvotes -= 1;
                    }
                } else {
                    const response = await fetch(`${API_BASE_URL}/problems/${problemId}/upvote`, {
                        method: 'POST'
                    });
                    if (response.ok) {
                        problem.upvoted = true;
                        problem.upvotes += 1;
                    }
                }
            } catch (error) {
                // Fallback to local state
                problem.upvoted = !problem.upvoted;
                problem.upvotes += problem.upvoted ? 1 : -1;
            }
            
            renderProblems(problems);
        }

        // View proposals
        async function viewProposals(problemId) {
            const proposalsSection = document.getElementById(`proposals-${problemId}`);
            
            if (proposalsSection.style.display === 'block') {
                proposalsSection.style.display = 'none';
                return;
            }

            proposalsSection.innerHTML = '<p style="text-align: center; color: #6B7280;">Loading proposals...</p>';
            proposalsSection.style.display = 'block';

            try {
                const response = await fetch(`${API_BASE_URL}/problems/${problemId}/proposals`);
                const data = await response.json();

                if (data.proposals && data.proposals.length > 0) {
                    proposalsSection.innerHTML = `
                        <h4 style="margin-bottom: 1rem; color: #111827;">üí° Solution Proposals (${data.proposals.length})</h4>
                        ${data.proposals.map(proposal => `
                            <div class="proposal-card">
                                <div class="proposal-header">
                                    <div>
                                        <div class="proposal-title">${proposal.title}</div>
                                        <div class="proposal-meta">
                                            <span>üë§ ${proposal.builderName}</span>
                                            <span>‚è±Ô∏è ${proposal.timeline}</span>
                                            <span class="proposal-badge">${proposal.status}</span>
                                        </div>
                                    </div>
                                    <button class="tip-btn" onclick="tipBuilder('${proposal.id}', '${proposal.builderName}')">üí∞ Tip</button>
                                </div>
                                <p class="proposal-description">${proposal.description}</p>
                                ${proposal.githubUrl || proposal.demoUrl ? `
                                    <div class="proposal-meta">
                                        ${proposal.githubUrl ? `<a href="${proposal.githubUrl}" target="_blank" class="proposal-link">üîó GitHub</a>` : ''}
                                        ${proposal.demoUrl ? `<a href="${proposal.demoUrl}" target="_blank" class="proposal-link">üöÄ Demo</a>` : ''}
                                    </div>
                                ` : ''}
                            </div>
                        `).join('')}
                    `;
                } else {
                    proposalsSection.innerHTML = '<div class="empty-proposals">No proposals yet. Be the first to submit a solution! üöÄ</div>';
                }
            } catch (error) {
                console.error('Error loading proposals:', error);
                proposalsSection.innerHTML = '<div class="empty-proposals">Failed to load proposals. Please try again.</div>';
            }
        }

        // Tip builder
        async function tipBuilder(proposalId, builderName) {
            if (!currentUser) {
                alert('Please sign in to tip builders.');
                showAuthModal('signin');
                return;
            }

            const amount = prompt(`How much would you like to tip ${builderName}? (e.g., 5, 10, 25)`);
            if (!amount || isNaN(amount) || amount <= 0) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/proposals/${proposalId}/tip`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${(await supabase.auth.getSession()).data.session?.access_token}`
                    },
                    body: JSON.stringify({ amount: parseFloat(amount) })
                });

                if (response.ok) {
                    alert(`Thank you for tipping ${builderName} $${amount}!`);
                } else {
                    throw new Error('Failed to process tip');
                }
            } catch (error) {
                console.error('Error tipping builder:', error);
                alert('Failed to process tip. Please try again.');
            }
        }

        // Filter and sort
        function filterProblems() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;
            const budgetRange = document.getElementById('budgetFilter').value;

            problems = allProblems.filter(p => {
                const matchesSearch = p.title.toLowerCase().includes(searchTerm) || 
                                     p.description.toLowerCase().includes(searchTerm);
                const matchesCategory = category === 'all' || p.category === category;
                
                let matchesBudget = true;
                if (budgetRange !== 'all') {
                    const [min, max] = budgetRange.split('-');
                    if (max === undefined) {
                        matchesBudget = p.budgetValue >= parseInt(min);
                    } else {
                        matchesBudget = p.budgetValue >= parseInt(min) && p.budgetValue <= parseInt(max);
                    }
                }

                return matchesSearch && matchesCategory && matchesBudget;
            });

            sortProblems();
        }

        function sortProblems() {
            const sortBy = document.getElementById('sortSelect').value;
            
            if (sortBy === 'upvotes') {
                problems.sort((a, b) => b.upvotes - a.upvotes);
            } else if (sortBy === 'newest') {
                problems.sort((a, b) => {
                    const timeA = parseTimeAgo(a.time);
                    const timeB = parseTimeAgo(b.time);
                    return timeA - timeB;
                });
            } else if (sortBy === 'budget') {
                problems.sort((a, b) => b.budgetValue - a.budgetValue);
            }

            renderProblems(problems);
        }

        function parseTimeAgo(timeStr) {
            const match = timeStr.match(/(\d+)\s+(minute|hour|day|week)/);
            if (!match) return 0;
            const value = parseInt(match[1]);
            const unit = match[2];
            const multipliers = { minute: 1, hour: 60, day: 1440, week: 10080 };
            return value * (multipliers[unit] || 0);
        }

        // Form submissions
        document.getElementById('problemForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const newProblem = {
                title: document.getElementById('problemTitle').value,
                description: document.getElementById('problemDescription').value,
                category: document.getElementById('problemCategory').value,
                budget: document.getElementById('problemBudget').value,
                author: currentUser?.user_metadata?.name || currentUser?.email || document.getElementById('problemAuthor').value || 'Anonymous User',
                userId: currentUser?.id
            };

            try {
                const response = await fetch(`${API_BASE_URL}/problems`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${(await supabase.auth.getSession()).data.session?.access_token}`
                    },
                    body: JSON.stringify(newProblem)
                });

                if (response.ok) {
                    const created = await response.json();
                    allProblems.unshift(created);
                    problems = [...allProblems];
                    renderProblems(problems);
                    closeModal();
                    alert('üéâ Problem posted successfully!');
                } else {
                    throw new Error('Failed to create problem');
                }
            } catch (error) {
                // Fallback to local
                const localProblem = {
                    id: String(Date.now()),
                    ...newProblem,
                    budgetValue: parseInt(newProblem.budget.match(/\d+/)?.[0] || '0'),
                    upvotes: 0,
                    proposals: 0,
                    time: 'just now',
                    upvoted: false
                };
                allProblems.unshift(localProblem);
                problems = [...allProblems];
                renderProblems(problems);
                closeModal();
                alert('üéâ Problem posted successfully!');
            }
        });

        document.getElementById('proposalForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!currentUser) {
                alert('Please sign in to submit a proposal.');
                showAuthModal('signin');
                return;
            }

            const problemId = document.getElementById('proposalProblemId').value;
            
            const proposalData = {
                title: document.getElementById('proposalTitle').value,
                description: document.getElementById('proposalDescription').value,
                timeline: document.getElementById('proposalTimeline').value,
                builderName: document.getElementById('proposalBuilderName').value,
                githubUrl: document.getElementById('proposalGithubUrl').value || null,
                demoUrl: document.getElementById('proposalDemoUrl').value || null,
                userId: currentUser.id
            };

            try {
                const response = await fetch(`${API_BASE_URL}/problems/${problemId}/proposals`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${(await supabase.auth.getSession()).data.session?.access_token}`
                    },
                    body: JSON.stringify(proposalData)
                });

                if (response.ok) {
                    const problem = problems.find(p => p.id === problemId);
                    if (problem) {
                        problem.proposals += 1;
                        renderProblems(problems);
                    }
                    
                    closeProposalModal();
                    alert('üéâ Proposal submitted successfully! The problem owner will be notified.');
                } else {
                    throw new Error('Failed to submit proposal');
                }
            } catch (error) {
                console.error('Error submitting proposal:', error);
                alert('Failed to submit proposal. Please try again.');
            }
        });

        // Auth form submissions
        document.getElementById('signInForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('signInEmail').value;
            const password = document.getElementById('signInPassword').value;

            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email,
                    password
                });

                if (error) throw error;

                currentUser = data.user;
                updateAuthUI();
                closeAuthModal();
                alert('Welcome back!');
            } catch (error) {
                alert('Sign in failed: ' + error.message);
            }
        });

        document.getElementById('signUpForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('signUpEmail').value;
            const password = document.getElementById('signUpPassword').value;
            const name = document.getElementById('signUpName').value;

            try {
                const { data, error } = await supabase.auth.signUp({
                    email,
                    password,
                    options: {
                        data: {
                            name: name
                        }
                    }
                });

                if (error) throw error;

                alert('Check your email for confirmation!');
                closeAuthModal();
            } catch (error) {
                alert('Sign up failed: ' + error.message);
            }
        });

        // Initialize on page load
        initAuth();
        renderProblems(problems);
    </script>
</body>
</html>